# Implementation Plan - Add Trading Plan Analysis

## Goal Description
Add a "Trading Plan Analysis" section below the main chart in [app.py](file:///c:/Users/Tomi/.gemini/app.py). This section will provide actionable trading insights based on the projected price movement, including trend direction, entry/target/stop-loss levels, and a success probability score derived from historical matches.

## User Review Required
> [!IMPORTANT]
> The "Success Probability" is calculated based on how many of the top 5 historical matches moved in the same direction as the average projection. This is a heuristic and not a guarantee of future performance.

## Proposed Changes

### [app.py](file:///c:/Users/Tomi/.gemini/app.py)

#### [MODIFY] [app.py](file:///c:/Users/Tomi/.gemini/app.py)
-   Locate the section where the chart is displayed (after `st.plotly_chart`).
-   Add logic to calculate:
    -   **Trend Direction**: Compare `last_price` vs `avg_path[-1]`.
    -   **Entry**: `last_price`.
    -   **Target**: `avg_path[-1]`.
    -   **Stop Loss**: Calculated using a 1:2 Risk/Reward ratio.
    -   **Success Probability**: Percentage of top matches that align with the projected direction.
    -   **Expected Move**: Difference in price and percentage.
-   Render the UI using `st.columns(3)` and `st.metric` (or custom HTML for "cards" if standard metrics are insufficient, but standard metrics are preferred for consistency).
-   Apply Green (Bullish) / Red (Bearish) styling to the metrics.

## Verification Plan

### Automated Tests
-   None (Visual UI change).

### Manual Verification
1.  Run the app (`streamlit run app.py`).
2.  Select a ticker (e.g., EURUSD=X).
3.  Click "Elemzés futtatása".
4.  Verify that a new section "Trading Plan Analysis" (or Hungarian equivalent) appears below the chart.
5.  Check that the calculations (Target, Stop Loss, Probability) look correct based on the chart.
6.  Verify that the colors (Green/Red) match the trend direction.
