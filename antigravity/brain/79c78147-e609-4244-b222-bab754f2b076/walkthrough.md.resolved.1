# Walkthrough - Financial Calculations Refactor

I have refactored [app.py](file:///c:/Users/Tomi/.gemini/app.py) to calculate and display HUF financial details in Telegram messages.

## Changes

### 1. HUF Rate Helper
Added [get_huf_rate(base_currency)](file:///c:/Users/Tomi/.gemini/app.py#42-65) function to fetch exchange rates using `yfinance`.
- Supports EUR, USD, GBP base currencies.
- Caches results for 1 hour.

```python
@st.cache_data(ttl=3600)
def get_huf_rate(base_currency):
    # ... fetches EURHUF=X, USDHUF=X, or GBPHUF=X ...
```

### 2. Financial Calculations
Implemented logic inside the main loop to calculate Margin, Profit, and Loss in HUF.
- **Margin:** [(1000 * Base_HUF_Rate) / 30](file:///c:/Users/Tomi/.gemini/app.py#156-404) (for 0.01 lot, 1:30 leverage).
- **Pip Value:**
    - For USD pairs: `0.1 * USDHUF_Rate`.
    - For JPY pairs: `10 * (USDHUF_Rate / 153.0)` (Approximation using USDHUF and estimated USDJPY).
- **Profit/Loss:** `Pips * Pip_Value_HUF`.

### 3. Telegram Message Redesign
Updated the Telegram message format to include a "Financials" section.

```
üí∞ **P√âNZ√úGYEK (0.01 Lot):**
üè¶ **Feltett T√©t (Margin):** ~{margin_huf} Ft
üéØ **V√°rhat√≥ Nyer≈ë:** +{profit_huf} Ft
üõ°Ô∏è **Max Buk√≥:** -{loss_huf} Ft
```

## Verification
I have verified that the code implements the logic as described in the user request. The [get_huf_rate](file:///c:/Users/Tomi/.gemini/app.py#42-65) function is called correctly, and the financial calculations use the fetched rates to populate the Telegram message.
