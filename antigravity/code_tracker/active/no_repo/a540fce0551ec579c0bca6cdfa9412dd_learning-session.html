à™<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanul√°si Munkamenet - Adapt√≠v Platform</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/components.css">

    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: grid;
            grid-template-areas:
                "header header header"
                "chat viz progress";
            grid-template-columns: 1fr 2fr 300px;
            grid-template-rows: auto 1fr;
            height: 100vh;
            gap: 0;
        }

        /* Header */
        .app-header {
            grid-area: header;
            background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: white;
            padding: var(--space-md) var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-lg);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .subject-badge {
            font-size: var(--font-size-2xl);
        }

        .header-title h1 {
            color: white;
            font-size: var(--font-size-xl);
            margin: 0;
        }

        .header-subtitle {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }

        /* Chat Panel */
        .chat-panel {
            grid-area: chat;
            background: var(--color-neutral-50);
            border-right: 1px solid var(--color-neutral-200);
            display: flex;
            flex-direction: column;
        }

        [data-theme="dark"] .chat-panel {
            background: var(--color-neutral-900);
            border-right-color: var(--color-neutral-700);
        }

        /* Visualization Panel */
        .viz-panel {
            grid-area: viz;
            background: white;
            padding: var(--space-xl);
            overflow-y: auto;
        }

        [data-theme="dark"] .viz-panel {
            background: var(--color-neutral-800);
        }

        .viz-empty {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--color-neutral-400);
            text-align: center;
        }

        .viz-empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-md);
        }

        /* Progress Sidebar */
        .progress-panel {
            grid-area: progress;
            background: var(--color-neutral-100);
            border-left: 1px solid var(--color-neutral-200);
            padding: var(--space-lg);
            overflow-y: auto;
        }

        [data-theme="dark"] .progress-panel {
            background: var(--color-neutral-850);
            border-left-color: var(--color-neutral-700);
        }

        .progress-section {
            margin-bottom: var(--space-xl);
        }

        .progress-section h3 {
            font-size: var(--font-size-md);
            margin-bottom: var(--space-md);
            color: var(--color-primary);
        }

        .concept-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .concept-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm);
            margin-bottom: var(--space-xs);
            background: white;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        [data-theme="dark"] .concept-item {
            background: var(--color-neutral-800);
        }

        .concept-mastery {
            font-weight: var(--font-weight-semibold);
            color: var(--color-success);
        }

        .concept-mastery.low {
            color: var(--color-error);
        }

        .concept-mastery.medium {
            color: var(--color-warning);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-areas:
                    "header"
                    "chat"
                    "viz";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr 1fr;
            }

            .progress-panel {
                display: none;
            }
        }

        /* Loading indicator */
        .ai-typing {
            display: flex;
            gap: var(--space-xs);
            padding: var(--space-sm);
        }

        .ai-typing span {
            width: 8px;
            height: 8px;
            background: var(--color-primary);
            border-radius: var(--radius-full);
            animation: typing 1.4s infinite;
        }

        .ai-typing span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.7;
            }

            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <span class="subject-badge" id="subjectIcon">üî¨</span>
                <div class="header-title">
                    <h1 id="subjectName">Term√©szettudom√°ny</h1>
                    <div class="header-subtitle" id="currentTopic">K√©sz√ºlj fel a tanul√°sra...</div>
                </div>
            </div>

            <div class="flex gap-sm">
                <button class="btn btn-ghost" id="homeBtn" style="color: white;">
                    üè† F≈ëoldal
                </button>
                <button class="btn btn-ghost" id="themeToggle" style="color: white;">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
        </header>

        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome message -->
                    <div class="chat-message ai animate-fade-in">
                        <div class="chat-avatar ai">AI</div>
                        <div class="chat-bubble">
                            üëã Szia! √ân vagyok a szem√©lyes tan√°ri asszisztensed.
                            Miben seg√≠thetek ma? K√©rdezz b√°tran b√°rmit, vagy mondd meg, mit szeretn√©l tanulni!
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input type="text" id="userInput" class="input" placeholder="√çrj ide k√©rd√©st vagy √ºzenetet..."
                            autocomplete="off">
                        <button class="btn btn-primary" id="sendBtn">
                            K√ºld√©s ‚û§
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualization Panel -->
        <div class="viz-panel" id="vizPanel">
            <div class="viz-empty">
                <div class="viz-empty-icon">‚ú®</div>
                <h3>Interakt√≠v Tartalom</h3>
                <p>Itt jelennek meg a szimul√°ci√≥k, grafikonok √©s vizualiz√°ci√≥k.</p>
            </div>
        </div>

        <!-- Progress Sidebar -->
        <div class="progress-panel">
            <div class="progress-section">
                <h3>üìä Halad√°s</h3>
                <div class="progress-label">
                    <span>√Åtlagos elsaj√°t√≠t√°s</span>
                    <span id="avgMastery">50%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="avgMasteryBar" style="width: 50%"></div>
                </div>
            </div>

            <div class="progress-section">
                <h3>‚úÖ Elsaj√°t√≠tott fogalmak</h3>
                <ul class="concept-list" id="masteredList">
                    <li class="concept-item" style="opacity: 0.5;">M√©g nincs elsaj√°t√≠tott fogalom</li>
                </ul>
            </div>

            <div class="progress-section">
                <h3>üéØ Jelenlegi f√≥kusz (ZPD)</h3>
                <ul class="concept-list" id="zpdList">
                    <li class="concept-item" style="opacity: 0.5;">Kezdd el a tanul√°st!</li>
                </ul>
            </div>

            <div class="progress-section">
                <h3>üí° Javaslatok</h3>
                <div id="recommendations" style="font-size: var(--font-size-sm); color: var(--color-neutral-600);">
                    Besz√©lgess folytat√≥dd a tanul√°st!
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="../js/config.js"></script>
    <script src="../js/gemini-agent.js"></script>
    <script src="../js/knowledge-tracing.js"></script>
    <script src="../js/adaptive-engine.js"></script>
    <script src="../subjects/science/knowledge-graph.js"></script>

    <script>
        // === Learning Session Application ===

        let agent, tracer, engine, knowledgeGraph, currentSubject;

        // Initialize the application
        async function initializeApp() {
            // Get subject from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentSubject = urlParams.get('subject') || 'science';

            // Update UI
            updateSubjectUI(currentSubject);

            // Get API key
            const apiKey = localStorage.getItem(CONFIG.STORAGE.API_KEY);
            if (!apiKey) {
                alert('API kulcs hi√°nyzik! √Åtir√°ny√≠t√°s a f≈ëoldalra...');
                window.location.href = '../index.html';
                return;
            }

            // Initialize components
            agent = new GeminiAgent(apiKey);
            tracer = new KnowledgeTracer('student_' + Date.now());

            // Load knowledge graph for subject
            if (currentSubject === 'science') {
                knowledgeGraph = scienceKnowledgeGraph;
            } else {
                // Geography KG would be loaded here
                alert('F√∂ldrajz modul hamarosan el√©rhet≈ë!');
                window.location.href = '../index.html';
                return;
            }

            // Initialize tracer with knowledge graph
            tracer.initializeFromKnowledgeGraph(knowledgeGraph);

            // Initialize agent
            await agent.initialize(currentSubject, tracer.export());

            // Initialize adaptive engine
            engine = new AdaptiveEngine(agent, tracer, knowledgeGraph);

            // Load saved progress (if exists)
            loadProgress();

            // Update progress UI
            updateProgressUI();

            console.log('‚úì App initialized successfully');
        }

        // Update subject-specific UI
        function updateSubjectUI(subject) {
            const config = subject === 'science' ? CONFIG.SUBJECTS.SCIENCE : CONFIG.SUBJECTS.GEOGRAPHY;
            document.getElementById('subjectIcon').textContent = config.icon;
            document.getElementById('subjectName').textContent = config.name;
            document.getElementById('currentTopic').textContent = `${config.grades} - Kezdj√ºk!`;
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message to chat
            addChatMessage('user', message);
            input.value = '';

            // Show typing indicator
            const typingId = showTypingIndicator();

            try {
                // Process through adaptive engine
                const response = await engine.processInput(message);

                // Remove typing indicator
                removeTypingIndicator(typingId);

                // Add AI response
                addChatMessage('ai', response.aiText);

                // Handle tools (simulations, visualizations)
                if (response.tools && response.tools.length > 0) {
                    handleTools(response.tools);
                }

                // Update progress UI
                updateProgressUI();

                // Show recommendations if any
                if (response.recommendations && response.recommendations.length > 0) {
                    displayRecommendations(response.recommendations);
                }

            } catch (error) {
                removeTypingIndicator(typingId);
                console.error('Error:', error);
                addChatMessage('ai', `‚ùå Hiba t√∂rt√©nt: ${error.message}. K√©rlek pr√≥b√°ld √∫jra!`);
            }
        }

        // Add message to chat
        function addChatMessage(role, text) {
            const messagesDiv = document.getElementById('chatMessages');

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role} animate-fade-in`;

            const avatar = document.createElement('div');
            avatar.className = `chat-avatar ${role}`;
            avatar.textContent = role === 'user' ? 'Te' : 'AI';

            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble';
            bubble.textContent = text;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            messagesDiv.appendChild(messageDiv);

            // Auto-scroll to bottom
            setTimeout(() => {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, CONFIG.UI.AUTO_SCROLL_DELAY);
        }

        // Typing indicator
        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const id = 'typing_' + Date.now();

            const messageDiv = document.createElement('div');
            messageDiv.id = id;
            messageDiv.className = 'chat-message ai';
            messageDiv.innerHTML = `
        <div class="chat-avatar ai">AI</div>
        <div class="chat-bubble">
          <div class="ai-typing">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      `;

            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            return id;
        }

        function removeTypingIndicator(id) {
            const elem = document.getElementById(id);
            if (elem) elem.remove();
        }

        // Update progress UI
        function updateProgressUI() {
            const state = engine.getStudentState();

            // Average mastery
            const avgPercent = Math.round(state.averageMastery * 100);
            document.getElementById('avgMastery').textContent = `${avgPercent}%`;
            document.getElementById('avgMasteryBar').style.width = `${avgPercent}%`;

            // Mastered concepts
            const mastered = tracer.getMasteredConcepts();
            const masteredList = document.getElementById('masteredList');
            masteredList.innerHTML = '';

            if (mastered.length === 0) {
                masteredList.innerHTML = '<li class="concept-item" style="opacity: 0.5;">M√©g nincs elsaj√°t√≠tott fogalom</li>';
            } else {
                mastered.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'concept-item';
                    li.innerHTML = `
            <span>${item.concept}</span>
            <span class="concept-mastery">${Math.round(item.mastery * 100)}%</span>
          `;
                    masteredList.appendChild(li);
                });
            }

            // ZPD concepts
            const zpd = tracer.getConceptsInZPD();
            const zpdList = document.getElementById('zpdList');
            zpdList.innerHTML = '';

            if (zpd.length === 0) {
                zpdList.innerHTML = '<li class="concept-item" style="opacity: 0.5;">Nincs akt√≠v tanul√°si c√©l</li>';
            } else {
                zpd.slice(0, 5).forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'concept-item';
                    const masteryClass = item.mastery < 0.5 ? 'low' : 'medium';
                    li.innerHTML = `
            <span>${item.concept}</span>
            <span class="concept-mastery ${masteryClass}">${Math.round(item.mastery * 100)}%</span>
          `;
                    zpdList.appendChild(li);
                });
            }
        }

        // Display recommendations
        function displayRecommendations(recommendations) {
            const recDiv = document.getElementById('recommendations');
            recDiv.innerHTML = '';

            recommendations.forEach(rec => {
                const p = document.createElement('p');
                p.style.marginBottom = 'var(--space-sm)';
                p.innerHTML = `<strong>${rec.type === 'focus' ? 'üéØ' : rec.type === 'challenge' ? 'üöÄ' : '‚≠ê'}</strong> ${rec.message}`;
                recDiv.appendChild(p);
            });
        }

        // Handle tools (simulations, visualizations)
        function handleTools(tools) {
            const vizPanel = document.getElementById('vizPanel');

            tools.forEach(tool => {
                if (tool.type === 'SIMULATION') {
                    vizPanel.innerHTML = `
            <div class="card">
              <h3>üß™ ${tool.target} Szimul√°ci√≥</h3>
              <p>[ Szimul√°ci√≥ hamarosan el√©rhet≈ë ]</p>
            </div>
          `;
                } else if (tool.type === 'VISUALIZATION') {
                    vizPanel.innerHTML = `
            <div class="card">
              <h3>üìä ${tool.target} Vizualiz√°ci√≥</h3>
              <p>[ Vizualiz√°ci√≥ hamarosan el√©rhet≈ë ]</p>
            </div>
          `;
                }
            });
        }

        // Save progress
        function saveProgress() {
            const data = tracer.export();
            localStorage.setItem('student_progress_' + currentSubject, JSON.stringify(data));
        }

        // Load progress
        function loadProgress() {
            const saved = localStorage.getItem('student_progress_' + currentSubject);
            if (saved) {
                tracer.import(JSON.parse(saved));
            }
        }

        // Event listeners
        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        document.getElementById('homeBtn').addEventListener('click', () => {
            if (confirm('Biztosan visszam√©sz a f≈ëoldalra? A halad√°sod mentve lesz.')) {
                saveProgress();
                window.location.href = '../index.html';
            }
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;

        const savedTheme = localStorage.getItem(CONFIG.STORAGE.THEME) || 'light';
        html.setAttribute('data-theme', savedTheme);
        themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem(CONFIG.STORAGE.THEME, newTheme);
        });

        // Auto-save progress every 30 seconds
        setInterval(saveProgress, 30000);

        // Save before unload
        window.addEventListener('beforeunload', saveProgress);

        // Initialize on load
        initializeApp();
    </script>
</body>

</html>à™*cascade082|file:///C:/Users/Tomi/Term%C3%A9szettudom%C3%A1ny,f%C3%B6ldrajz%20%C3%B6n%C3%A1ll%C3%B3%20modell/pages/learning-session.html