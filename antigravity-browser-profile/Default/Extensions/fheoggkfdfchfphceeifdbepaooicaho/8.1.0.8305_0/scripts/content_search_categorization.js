/*!
 * 
 *     MCAFEE RESTRICTED CONFIDENTIAL
 *     Copyright (c) 2025 McAfee, LLC
 *
 *     The source code contained or described herein and all documents related
 *     to the source code ("Material") are owned by McAfee or its
 *     suppliers or licensors. Title to the Material remains with McAfee
 *     or its suppliers and licensors. The Material contains trade
 *     secrets and proprietary and confidential information of McAfee or its
 *     suppliers and licensors. The Material is protected by worldwide copyright
 *     and trade secret laws and treaty provisions. No part of the Material may
 *     be used, copied, reproduced, modified, published, uploaded, posted,
 *     transmitted, distributed, or disclosed in any way without McAfee's prior
 *     express written permission.
 *
 *     No license under any patent, copyright, trade secret or other intellectual
 *     property right is granted to or conferred upon you by disclosure or
 *     delivery of the Materials, either expressly, by implication, inducement,
 *     estoppel or otherwise. Any license under such intellectual property rights
 *     must be expressed and approved by McAfee in writing.
 *
 */(()=>{"use strict";const e="TI_REQUEST",t="NATIVE_TELEMETRY",r="PING_CONTENT_SEARCH_CATEGORIZATION",s=0,o="PRINT_IN_BACKGROUND",n={NONE:0,INFO:1,ERROR:2,WARN:3,DEBUG:4,ALL_IN_BACKGROUND:99},i=1,c=2,a=3,l=4,h={BACKGROUND:"BACKGROUND",CONTENT:"CONTENT",TELEMETRY:"TELEMETRY"},u={DEFAULT:"color: #000000; font-weight: normal; font-style:normal; background: #FFFFFF;",BACKGROUND:"color: #8D0DBA; font-weight: bold; background: #FFFFFF;",CONTENT:"color: #F54A26; font-weight: bold; background: #FFFFFF;",TELEMETRY:"color: #147831; font-weight: bold; background: #FFFFFF;"};const d=new class{constructor(){this.storageChecked=!1,this.logLevel=null,this.queue=[];const e="MCLOGLEVEL";chrome?.storage?.local.get([e]).then(t=>{const r=Object.values(n).includes(t[e]);this.logLevel=r?t[e]:s,this.logLevel!==n.NONE&&this.queue.forEach(({callback:e,message:t,processType:r})=>{e(t,r)}),this.queue=[],this.storageChecked=!0})}log(e,t=null){this.storageChecked?this.processLog(e,i,t,this.logLevel):this.queue.push({callback:this.log.bind(this),message:e,processType:t})}error(e,t=null){this.storageChecked?this.processLog(e,c,t,this.logLevel):this.queue.push({callback:this.error.bind(this),message:e,processType:t})}warn(e,t=null){this.storageChecked?this.processLog(e,a,t,this.logLevel):this.queue.push({callback:this.warn.bind(this),message:e,processType:t})}debug(e,t=null){this.storageChecked?this.processLog(e,l,t,this.logLevel):this.queue.push({callback:this.debug.bind(this),message:e,processType:t})}processLog(e,t,r,s){if(s===n.NONE)return;let i="chrome-extension:"===location.protocol?h.BACKGROUND:h.CONTENT;r&&h[r]&&(i=r);const a=this.formatDateWithMilliseconds(new Date),l=t===c?e:`%c[${i} ${a} ]: %c${e}`;i===h.CONTENT&&this.logLevel===n.ALL_IN_BACKGROUND&&chrome.runtime.sendMessage({command:o,logMessage:l,processType:i,logType:t,logLevel:s}),this.printLog(l,i,t,s)}formatDateWithMilliseconds(e){return`${new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(e)}.${e.getMilliseconds().toString().padStart(3,"0")}`}printLog(e,t,r,s){const o=u.DEFAULT,h=u[t]||o;if(s>=n.ERROR&&r===c&&console.error(e),s>=n.INFO&&r===i&&console.log(e,h,o),s>=n.WARN&&r===a){const t="color: #FFA500; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cWARN - ${e}`,t,h,o)}if(s>=n.DEBUG&&r===l){const t="color: #FF33D7; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cDEBUG - ${e}`,t,h,o)}}},g=async(e,t,r,s)=>{try{chrome.tabs.sendMessage(s,{ipcId:e,command:t,...r},{},()=>{chrome.runtime.lastError})}catch(e){d.warn(`[broadcast] Unexpected error when calling command: "${t}", err: ${e.message}`)}},m=(e,t,r,s,o=null)=>{if(!chrome.tabs)throw new Error('"tabs" permission not set in manifest.');const n={};return"number"==typeof o&&(n.frameId=o),chrome.tabs.sendMessage(s,{ipcId:e,command:t,...r},n)},p=(e,t={},r)=>(async(e,t,r={},s={})=>{try{if(s?.tabId){const{tabId:o,frameId:n}=s;return await m(e,t,r,o,n)}if(s?.broadcast){const o=await chrome.tabs.query({}),{broadcastIgnoreId:n=[]}=s;return o.filter(({id:e})=>!n.includes(e)).forEach(({id:s})=>{g(e,t,r,s)}),!0}return await chrome.runtime.sendMessage({ipcId:e,command:t,...r})}catch(e){return d.warn(`Unexpected error when calling command: "${t}", err: ${e.message}`),null}})("WA",e,t,r),E=e=>{"undefined"!=typeof document&&null!==document&&("complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e))};class f{constructor(e,t){this.pingCommand=e,this.ipcId=t,this.mainFunction="function"==typeof this.main?((e,t)=>{let r;return(...s)=>(e&&(r=e.apply(t||void 0,s),e=null,t=null),r)})(this.main,this):()=>{},this.basePingListener(),this.addIdentifier()}basePingListener(){((e,t=null,r)=>{"function"==typeof r?chrome.runtime.onMessage.addListener((s,o,n)=>{if(o.id===chrome.runtime.id&&"object"==typeof s&&!Array.isArray(s)&&s?.ipcId===e)return r({promises:t,request:s,sender:o,sendResponse:n})}):d.error("Provided with invalid callback function")})(this.ipcId,null,({request:e,sendResponse:t})=>{const{command:r,...s}=e;if(r===this.pingCommand)return d.debug(`File Injection [pinged]: Received ${r} command`),t({content:!0}),"function"==typeof this.mainFunction&&this.mainFunction(s),"function"==typeof this.callback&&this.callback(),!0})}addIdentifier(){E(()=>{const e=document.createElement("span");e.id=this.pingCommand,e.style.cssText="display:none",document.body.appendChild(e)})}}const y={NONE:0,LINKEDIN:1,INSTAGRAM:2,YOUTUBE:4,FACEBOOK:8,TWITTER:16,REDDIT:32},N=(Object.values(y).reduce((e,t)=>e+t),{NONE:"NONE",ONLY_SECURE_SEARCH:"ONLY_SECURE_SEARCH",ALL:"ALL",*[Symbol.iterator](){for(const e of Object.keys(this))yield e}}),{NONE:T,...b}=y,R={name:"FINGER_PRINT",type:"number"},L={name:"FIRST_PARTY",type:"number"},C={name:"THIRD_PARTY",type:"number"},F=chrome,A=(Symbol.iterator,(e,t)=>Array.from(Array(t+1).keys()).slice(e)),S=(F.runtime.getURL(""),R.name,L.name,C.name,"SearchCategorization");A(48,57),A(65,90),A(96,107),A(109,111),A(186,192),A(219,222);new class extends f{constructor(){super(r,"WA"),this.searchEngine="unknown",this.isSecureSearch=!1}async main(e){const{searchEngine:t,isSecureSearch:r=!1}=e;this.searchEngine=t||"unknown",this.isSecureSearch=r,this.searchEngine&&"unknown"!==this.searchEngine&&E(()=>{this.categorizeSearchResults()})}async categorizeSearchResults(){try{const e=this.getTopSearchResults(5);if(0===e.length)return;const t=await this.requestCategories(e),r=this.buildCategoryCounts(t,e);d.log(`Search result category counts: ${JSON.stringify(r)}`),this.sendCategoryTelemetry(r)}catch(e){d.error(`Error categorizing search results: ${e}`)}}getTopSearchResults(e=5){const t=document.querySelectorAll("a[href]"),r=new Set;for(let s=0;s<t.length&&r.size<e;s++){const e=t[s].href;!r.has(e)&&this.isValidSearchResultUrl(e)&&(r.add(e),d.log(`Added valid result ${r.size}: ${e}`))}return Array.from(r)}isValidSearchResultUrl(e){try{const t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;if(e.toLowerCase().includes(this.searchEngine.toLowerCase()))return!1;const r=["/search?","mailto:","#"];for(const t of r)if(e.includes(t))return!1;return!0}catch(e){return d.error(`Error validating URL: ${e}`),!1}}async requestCategories(t){try{return await p(e,{requestData:t,referer:null})}catch(e){return d.error(`Error requesting categories from TI: ${e}`),null}}buildCategoryCounts(e,t){const r={};return e&&e.annotationMap?(t.forEach(t=>{const s=e.annotationMap[t];s&&s.category&&Array.isArray(s.category)&&s.category.forEach(e=>{e&&(r[e]=(r[e]||0)+1)})}),r):r}sendCategoryTelemetry(e){const r={identifier:S,isFromBackground:!0,searchEngine:this.searchEngine,isSecureSearch:this.isSecureSearch,categoriesCounts:e};d.log(`Sending category telemetry: ${JSON.stringify(r)}`),p(t,r)}}})();
//# sourceMappingURL=../sourceMap/chrome/scripts/content_search_categorization.js.map