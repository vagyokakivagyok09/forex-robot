<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mechanika Bajnoks√°g</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF5722; /* Narancs */
            --secondary: #4CAF50; /* Z√∂ld */
            --accent: #2196F3; /* K√©k */
            --danger: #E74C3C;
            --dark: #37474F;
            --light: #ECEFF1;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #37474F 0%, #546E7A 100%);
            color: var(--dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 700px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 { color: var(--dark); font-size: 1.8rem; margin-bottom: 10px; }
        h2 { color: var(--accent); font-size: 1.4rem; }
        
        .btn {
            background: linear-gradient(to right, var(--primary), #FF7043);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px auto;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            min-width: 150px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 87, 34, 0.5);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-menu {
            background: var(--accent);
            color: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background 0.2s;
            font-size: 1rem;
            font-family: inherit;
        }

        .btn-menu:hover { background: #1565C0; }
        
        .status-badge {
            background: rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .status-done { background: var(--secondary); color: white; }
        
        .screen { display: none; animation: fadeIn 0.5s; }
        .active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .score-board {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 15px;
            background: #E8F5E9;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
        }

        /* Feladat specifikus st√≠lusok */
        ul, ol { padding-left: 20px; text-align: left; }
        li { margin-bottom: 15px; }
        
        .question-text { font-weight: 600; margin-bottom: 5px; }
        
        label { display: block; margin: 5px 0; cursor: pointer; }
        input[type="radio"] { margin-right: 10px; transform: scale(1.2); }

        /* P√°ros√≠t√°s */
        .pairing-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .term-list-wrapper {
            width: 100%;
            background: #FFFDE7;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .term-button {
            background: var(--primary);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: grab;
            font-size: 0.9rem;
            user-select: none;
        }
        
        .term-button.used { opacity: 0.3; cursor: default; }

        .definition-wrapper {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .definition-wrapper { grid-template-columns: 1fr; }
        }

        .definition-zone {
            border: 2px dashed var(--secondary);
            border-radius: 10px;
            padding: 10px;
            background: #F1F8E9;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .definition-zone.matched {
            background: #C8E6C9;
            border-style: solid;
        }

        /* Kieg√©sz√≠t√©s */
        .completion-item {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: left;
        }
        
        .blank-select {
            border: 2px solid var(--accent);
            border-radius: 5px;
            padding: 2px 5px;
            font-weight: bold;
            color: var(--accent);
            background: white;
            cursor: pointer;
            max-width: 100%;
        }

        .feedback {
            font-size: 1.1rem;
            margin-top: 20px;
            font-weight: bold;
            min-height: 30px;
            padding: 10px;
            border-radius: 10px;
        }
        .correct { color: #1B5E20; background: #C8E6C9; }
        .wrong { color: #B71C1C; background: #FFCDD2; }

        .emoji-big { font-size: 3rem; margin: 10px; }

    </style>
<script defer data-domain="osszefoglalas.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script><script type="text/javascript" src="https://tiiny.host/ad-script.js"></script></head>
<body>

<div class="container">
    <div id="start-screen" class="screen active">
        <h1>‚öõÔ∏è Mechanika Bajnoks√°g</h1>
        <div class="emoji-big">‚öôÔ∏è</div>
        <p>4 K√ºldet√©s v√°r r√°d!</p>
        <p>√ñsszesen <strong id="start-total">34</strong> pont gy≈±jthet≈ë.</p>
        <button class="btn" onclick="app.showMenu()">Ind√≠t√°s!</button>
    </div>

    <div id="menu-screen" class="screen">
        <h1>K√ºldet√©sv√°laszt√≥ üß≠</h1>
        <div class="score-board">Pontsz√°m: <span id="menu-score">0</span> / <span id="menu-total">0</span></div>
        <div id="mission-list"></div>
        <button class="btn" onclick="app.showEndScreen()" style="background: var(--secondary); margin-top: 20px;">Eredm√©nyhirdet√©s</button>
    </div>

    <div id="task-screen" class="screen">
        <button class="btn" style="width: auto; padding: 5px 15px; font-size: 0.8rem; background: #90A4AE;" onclick="app.showMenu()">‚¨ÖÔ∏è Vissza a men√ºbe</button>
        <h2 id="task-title" style="margin-top: 10px;">Feladat</h2>
        <div id="task-container"></div>
        <div id="feedback-area"></div>
    </div>

    <div id="end-screen" class="screen">
        <h1>Gratul√°lok! üéâ</h1>
        <div class="emoji-big">üèÜ</div>
        <h2>V√©geredm√©ny: <span id="final-score">0</span> / <span id="total-q-end">0</span></h2>
        <p id="evaluation-text"></p>
        <button class="btn" onclick="location.reload()">√öjra j√°tszom!</button>
    </div>
</div>

<script>
// --- ADATOK ---
const data = {
    tasks: [
        {
            id: "t1", name: "1. Igaz/Hamis", emoji: "‚úÖ", maxScore: 10, type: "tf",
            questions: [
                { q: "A mechanika a mozg√°s √©s az er≈ëhat√°sok tudom√°nya.", a: true },
                { q: "A gravit√°ci√≥s k√∂lcs√∂nhat√°s mindig vonz√≥ hat√°s√∫.", a: true },
                { q: "A termikus k√∂lcs√∂nhat√°s sor√°n a h≈ë a hidegebb testt≈ël √°ramlik a melegebb fel√©.", a: false },
                { q: "A felemelt test mozg√°si energi√°val rendelkezik.", a: false },
                { q: "A l√°ng energi√°ja az √©g√©s sor√°n felszabadul√≥ h≈ëb≈ël sz√°rmazik.", a: true },
                { q: "Az azonos elektromos √°llapot√∫ testek tasz√≠tj√°k egym√°st.", a: true },
                { q: "A k≈ëolaj ≈ësi tengeri √©l≈ël√©nyek maradv√°nyaib√≥l keletkezett.", a: true },
                { q: "A bels≈ë energia a r√©szecsk√©k mozg√°s√°b√≥l √©s k√∂lcs√∂nhat√°saib√≥l sz√°rmaz√≥ energia.", a: true },
                { q: "A k≈ësz√©n a Nap vonz√°sa miatt tartja √∂ssze a Naprendszert.", a: false },
                { q: "A mozg√°s√°llapot v√°ltoz√°sa mindig er≈ëhat√°s k√∂vetkezm√©nye.", a: true }
            ]
        },
        {
            id: "t2", name: "2. Kv√≠z", emoji: "‚ùì", maxScore: 10, type: "quiz",
            questions: [
                { q: "Melyik energiafajta kapcsol√≥dik a sebess√©ghez?", options: ["Rugalmas", "Helyzeti", "Mozg√°si"], correct: 2 },
                { q: "Ki vizsg√°lta a gravit√°ci√≥t az ing√°val?", options: ["Teller Ede", "E√∂tv√∂s Lor√°nd", "Bay Zolt√°n"], correct: 1 },
                { q: "Mi t√∂rt√©nik termikus k√∂lcs√∂nhat√°skor?", options: ["Mindk√©t test leh≈±l", "K√∂z√∂s h≈ëm√©rs√©klet alakul ki", "Meg√°llnak a r√©szecsk√©k"], correct: 1 },
                { q: "Mi a k√©pess√©g a fizikai √°llapot megv√°ltoztat√°s√°ra?", options: ["Er≈ëhat√°s", "K√∂lcs√∂nhat√°s", "Energia"], correct: 2 },
                { q: "Mib≈ël √°ll f≈ëleg a Nap?", options: ["Sz√©n-dioxid", "Oxig√©n", "Hidrog√©n √©s H√©lium"], correct: 2 },
                { q: "Miv√© alak√≠tja a sz√©lker√©k a sz√©l energi√°j√°t?", options: ["Helyzeti", "Forg√°si", "Elektromos"], correct: 1 },
                { q: "Milyen hat√°ssal van a F√∂ld az ir√°nyt≈±re?", options: ["Gravit√°ci√≥s", "Termikus", "M√°gneses"], correct: 2 },
                { q: "Mi a h≈ëer≈ëm≈±vek f≈ë h√°tr√°nya?", options: ["Dr√°ga", "Szennyez≈ë", "Halk"], correct: 1 },
                { q: "Milyen t√∂lt√©sek vonzz√°k egym√°st?", options: ["Azonos", "Semleges", "K√ºl√∂nb√∂z≈ë"], correct: 2 },
                { q: "Mi a h≈ë?", options: ["Gyors mozg√°s", "√Åtadott energia", "H≈ëm√©rs√©klet"], correct: 1 }
            ]
        },
        {
            id: "t3", name: "3. P√°ros√≠t√°s", emoji: "üîó", maxScore: 6, type: "pairing",
            pairs: {
                "Mechanika": "A mozg√°s √©s az er≈ëhat√°sok tudom√°nya.",
                "K√∂lcs√∂nhat√°s": "K√©t test egym√°sra gyakorolt hat√°sa.",
                "Helyzeti energia": "A magasra emelt test energi√°ja.",
                "Bels≈ë energia": "R√©szecsk√©k mozg√°s√°b√≥l sz√°rmaz√≥ energia.",
                "H≈ë√°raml√°s": "H≈ë √°raml√°sa melegebbr≈ël hidegebbre.",
                "Gravit√°ci√≥": "Mindig vonz√≥ k√∂lcs√∂nhat√°s."
            }
        },
        {
            id: "t4", name: "4. Kieg√©sz√≠t√©s", emoji: "üìù", maxScore: 8, type: "completion",
            questions: [
                { text: "A h≈ë mindig a [melegebb] testt≈ël √°ramlik a [hidegebb] fel√©.", blanks: ["melegebb", "hidegebb"] },
                { text: "A m√°gnes [vasb√≥l] vagy [ac√©lb√≥l] k√©sz√ºlt t√°rgyakat vonz.", blanks: ["vasb√≥l", "ac√©lb√≥l"] },
                { text: "A bels≈ë energia n≈ëhet [h≈ëk√∂zl√©ssel] vagy [mechanikai] munk√°val.", blanks: ["h≈ëk√∂zl√©ssel", "mechanikai"] },
                { text: "A F√∂ld [vonz√°sa] tartja a Holdat √©s a [mesters√©ges] holdakat p√°ly√°n.", blanks: ["vonz√°sa", "mesters√©ges"] }
            ]
        }
    ]
};

// --- ALKALMAZ√ÅS LOGIKA ---
const app = {
    state: {
        totalScore: 0,
        taskScores: {}, // { t1: 0, t2: 5 ... }
        completed: {}   // { t1: true ... }
    },
    
    init: function() {
        // Sz√≥bank gener√°l√°sa a 4. feladathoz
        this.wordBank = [];
        data.tasks.find(t => t.type === 'completion').questions.forEach(q => {
            this.wordBank.push(...q.blanks);
        });
        this.wordBank = [...new Set(this.wordBank)].sort(() => Math.random() - 0.5);

        // Total max score
        this.maxTotal = data.tasks.reduce((acc, t) => acc + t.maxScore, 0);
        
        document.getElementById('start-total').innerText = this.maxTotal;
        document.getElementById('menu-total').innerText = this.maxTotal;
        document.getElementById('total-q-end').innerText = this.maxTotal;
    },

    switchScreen: function(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    },

    showMenu: function() {
        this.switchScreen('menu-screen');
        this.renderMenu();
    },

    renderMenu: function() {
        const list = document.getElementById('mission-list');
        list.innerHTML = '';
        document.getElementById('menu-score').innerText = this.state.totalScore;

        data.tasks.forEach(task => {
            const isDone = this.state.completed[task.id];
            const score = this.state.taskScores[task.id] || 0;
            const btn = document.createElement('button');
            btn.className = 'btn-menu';
            btn.innerHTML = `
                <span>${task.emoji} ${task.name}</span>
                <span class="status-badge ${isDone ? 'status-done' : ''}">
                    ${isDone ? 'K√©sz: ' + score + '/' + task.maxScore : 'Ind√≠t√°s'}
                </span>
            `;
            btn.onclick = () => this.startTask(task);
            list.appendChild(btn);
        });
    },

    startTask: function(task) {
        this.currentTask = task;
        this.switchScreen('task-screen');
        document.getElementById('task-title').innerText = task.name;
        document.getElementById('feedback-area').innerHTML = ''; // Reset feedback
        const container = document.getElementById('task-container');
        container.innerHTML = '';

        if (task.type === 'tf') this.renderTF(container, task);
        else if (task.type === 'quiz') this.renderQuiz(container, task);
        else if (task.type === 'pairing') this.renderPairing(container, task);
        else if (task.type === 'completion') this.renderCompletion(container, task);
    },

    // --- RENDEREREK ---

    renderTF: function(container, task) {
        const isDone = this.state.completed[task.id];
        let html = '<ol>';
        task.questions.forEach((item, index) => {
            html += `<li>
                <div class="question-text">${item.q}</div>
                <label><input type="radio" name="q${index}" value="true" ${isDone ? 'disabled' : ''}> Igaz</label>
                <label><input type="radio" name="q${index}" value="false" ${isDone ? 'disabled' : ''}> Hamis</label>
            </li>`;
        });
        html += '</ol>';
        if (!isDone) html += `<button class="btn" onclick="app.checkTF()">Ellen≈ërz√©s</button>`;
        else html += `<div class="feedback correct">M√°r teljes√≠tetted ezt a feladatot.</div>`;
        container.innerHTML = html;
    },

    checkTF: function() {
        let score = 0;
        const task = this.currentTask;
        const inputs = document.querySelectorAll('#task-container input:checked');
        
        task.questions.forEach((item, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (selected && JSON.parse(selected.value) === item.a) score++;
        });

        this.finishTask(score);
    },

    renderQuiz: function(container, task) {
        const isDone = this.state.completed[task.id];
        let html = '<ol>';
        task.questions.forEach((item, index) => {
            html += `<li>
                <div class="question-text">${item.q}</div>`;
            item.options.forEach((opt, optIndex) => {
                html += `<label><input type="radio" name="q${index}" value="${optIndex}" ${isDone ? 'disabled' : ''}> ${opt}</label>`;
            });
            html += `</li>`;
        });
        html += '</ol>';
        if (!isDone) html += `<button class="btn" onclick="app.checkQuiz()">Ellen≈ërz√©s</button>`;
        else html += `<div class="feedback correct">M√°r teljes√≠tetted ezt a feladatot.</div>`;
        container.innerHTML = html;
    },

    checkQuiz: function() {
        let score = 0;
        const task = this.currentTask;
        task.questions.forEach((item, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (selected && parseInt(selected.value) === item.correct) score++;
        });
        this.finishTask(score);
    },

    renderPairing: function(container, task) {
        const isDone = this.state.completed[task.id];
        const terms = Object.keys(task.pairs).sort(() => Math.random() - 0.5);
        const defs = Object.values(task.pairs).sort(() => Math.random() - 0.5);

        // D&D Logic variables attached to DOM elements later
        let html = `<div class="pairing-container">`;
        
        // Terms (Draggable)
        html += `<div class="term-list-wrapper">`;
        terms.forEach(term => {
            html += `<div class="term-button" draggable="${!isDone}" id="term-${term}">${term}</div>`;
        });
        html += `</div>`;

        // Definitions (Drop zones)
        html += `<div class="definition-wrapper">`;
        defs.forEach((def, idx) => {
            html += `<div class="definition-zone" data-def="${def}" id="def-${idx}">${def}</div>`;
        });
        html += `</div></div>`;

        if (!isDone) html += `<button class="btn" onclick="app.checkPairing()">Ellen≈ërz√©s</button>`;
        else html += `<div class="feedback correct">M√°r teljes√≠tetted ezt a feladatot.</div>`;
        
        container.innerHTML = html;

        if (!isDone) this.addDragEvents();
    },

    addDragEvents: function() {
        let dragged = null;
        document.querySelectorAll('.term-button').forEach(el => {
            el.addEventListener('dragstart', e => {
                dragged = e.target;
                e.dataTransfer.setData('text', e.target.innerText);
                e.target.style.opacity = '0.5';
            });
            el.addEventListener('dragend', e => {
                e.target.style.opacity = '1';
            });
        });

        document.querySelectorAll('.definition-zone').forEach(el => {
            el.addEventListener('dragover', e => {
                e.preventDefault();
                if (!el.classList.contains('matched')) el.style.background = '#DCEDC8';
            });
            el.addEventListener('dragleave', e => {
                if (!el.classList.contains('matched')) el.style.background = '#F1F8E9';
            });
            el.addEventListener('drop', e => {
                e.preventDefault();
                if (el.classList.contains('matched')) return;
                
                const term = e.dataTransfer.getData('text');
                const correctDef = app.currentTask.pairs[term];
                
                // Azonnali vizu√°lis visszajelz√©s (nem v√©gleges ellen≈ërz√©s)
                el.classList.add('matched');
                el.innerHTML = `<strong>${term}</strong><br><small>${el.getAttribute('data-def')}</small>`;
                el.dataset.droppedTerm = term; // Elt√°roljuk az ellen≈ërz√©shez
                
                // Eredeti gomb elrejt√©se
                const originalBtn = Array.from(document.querySelectorAll('.term-button')).find(b => b.innerText === term);
                if(originalBtn) originalBtn.classList.add('used');
                if(originalBtn) originalBtn.draggable = false;
            });
        });
    },

    checkPairing: function() {
        let score = 0;
        const zones = document.querySelectorAll('.definition-zone');
        zones.forEach(z => {
            const dropped = z.dataset.droppedTerm;
            const def = z.getAttribute('data-def');
            if (dropped && this.currentTask.pairs[dropped] === def) {
                score++;
            }
        });
        this.finishTask(score);
    },

    renderCompletion: function(container, task) {
        const isDone = this.state.completed[task.id];
        let html = '<div style="margin-bottom:15px;">';
        
        task.questions.forEach((item, index) => {
            // Replace [word] with select box
            let sentence = item.text;
            let blankIndex = 0;
            sentence = sentence.replace(/\[(.*?)\]/g, (match, p1) => {
                let select = `<select class="blank-select" data-correct="${p1}" ${isDone ? 'disabled' : ''}>`;
                select += `<option value="">...</option>`;
                this.wordBank.forEach(word => {
                    select += `<option value="${word}">${word}</option>`;
                });
                select += `</select>`;
                blankIndex++;
                return select;
            });
            html += `<div class="completion-item">${sentence}</div>`;
        });
        html += '</div>';

        if (!isDone) html += `<button class="btn" onclick="app.checkCompletion()">Ellen≈ërz√©s</button>`;
        else html += `<div class="feedback correct">M√°r teljes√≠tetted ezt a feladatot.</div>`;
        container.innerHTML = html;
    },

    checkCompletion: function() {
        let score = 0;
        const selects = document.querySelectorAll('.blank-select');
        selects.forEach(sel => {
            if (sel.value === sel.dataset.correct) score++;
        });
        this.finishTask(score);
    },

    // --- K√ñZ√ñS BEFEJEZ≈ê F√úGGV√âNY ---
    finishTask: function(score) {
        const task = this.currentTask;
        
        // Update State
        const oldScore = this.state.taskScores[task.id] || 0;
        this.state.totalScore += (score - oldScore);
        this.state.taskScores[task.id] = score;
        this.state.completed[task.id] = true;

        // Feedback UI
        const fbArea = document.getElementById('feedback-area');
        fbArea.innerHTML = `
            <div class="feedback ${score === task.maxScore ? 'correct' : 'wrong'}">
                Eredm√©ny: ${score} / ${task.maxScore} pont.<br>
                ${score === task.maxScore ? 'T√∂k√©letes! üéâ' : 'Sz√©p munka!'}
            </div>
        `;

        // Disable inputs
        const inputs = document.querySelectorAll('input, select, button:not(.btn-menu)');
        inputs.forEach(i => i.disabled = true);

        // Auto return to menu after delay
        setTimeout(() => {
            this.showMenu();
        }, 2000);
    },

    showEndScreen: function() {
        this.switchScreen('end-screen');
        document.getElementById('final-score').innerText = this.state.totalScore;
        
        let percent = (this.state.totalScore / this.maxTotal) * 100;
        let msg = "Gyakorolj m√©g kicsit!";
        if (percent > 50) msg = "√úgyes vagy!";
        if (percent > 80) msg = "Fantasztikus teljes√≠tm√©ny! üåü";
        
        document.getElementById('evaluation-text').innerText = msg;
    }
};

// Ind√≠t√°s
app.init();

</script>
</body>
</html>